/*
 Project Name: GA Aware
 URL: https://github.com/keobrien/GA-Aware
 Author: Kevin O'Brien
 Company: Clockwork Active Media Systems
 Company Site: clockwork.net
 License: MIT
 Copyright (C) 2012 Clockwork Active Media Systems
 Version: 1.9.11
 **************************************/

(function(g){g.fn.gaaware=function(c){return new g.gaaware(this,c)};g.gaaware=function(c,a){this.s=g.extend({UA:"UA-XXXXX-X",alt_UA:[],d:window.document.domain,domains:[],include_only:null,exclude_subdomains:"preview dev test stage review demo train".split(" "),asset_extentions:"pdf txt csv doc docx xls xlsx ppt jpg jpeg png gif psd ai eps zip xml json avi mp4 mp3 mov mpeg wmv rtf swf flv js css eot svg ttf woff otf".split(" "),track_alt_protocols:["mailto","spotify","ftp","file","tel"],vpv_prefix:"/vpv",
track_external_links:!0,external_prefix:"External",asset_prefix:"Asset",hash_prefix:"Hash",external_form_prefix:"Form",cross_domain_prefix:"CrossDomain",track_as_events:!0,debug:!1,debug_mode:function(a){console.info(a)},track:!0,auto_track_page_view:!0,no_track_class:"ga_notrack",custom_vars:[],auto_social:!1,social_page_url:null,enable_facebook:!0,enable_twitter:!0,prefer_title:!0,track_right_clicks:!0,bouce_defeat:3E4,session_keeper:15E5,dow_custom_var:4,hod_custom_var:5,enhanced_link_attribution:!1,
demographics_tracking:!1},a);if(this.s.track)return window._gaq=window._gaq||[],this.current_domain_state=null,this.track_multi=this.s.UA.constructor===Array?!0:!1,this.alt_track_multi=this.s.alt_UA.constructor===Array?!0:!1,this.first_load=this.cross_domain_disabled=!1,this.s.UA=this.track_multi?this.s.UA:[this.s.UA],this.s.alt_UA=this.alt_track_multi?this.s.alt_UA:[this.s.alt_UA],this.setup(),this};g.gaaware.prototype={setup:function(){var c=this;if(this.s.track){var a=!1,e=!1;g(document.cookie.split(";")).each(function(c,
b){var d=this.substr(0,this.indexOf("=")).replace(/ /g,"");"__utmb"==d&&(a=!0);"__utmc"==d&&(e=!0)});a&&e||(this.first_load=!0);this.s.debug&&this.s.debug_mode("GA First View In Session: "+this.first_load);for(var b=!1,d=!1,f=0;f<this.s.custom_vars.length;f++)this.s.dow_custom_var&&this.s.custom_vars[f][0]==this.s.dow_custom_var&&(b=!0),this.s.hod_custom_var&&this.s.custom_vars[f][0]==this.s.hod_custom_var&&(d=!0);!b&&this.s.dow_custom_var?this.s.custom_vars.push([this.s.dow_custom_var,"Day Of Week",
(new Date).getDay().toString()]):this.s.debug&&this.s.debug_mode("Day of Week custom variable not set or in conflict, not tracking in slot "+this.s.dow_custom_var);!d&&this.s.hod_custom_var?this.s.custom_vars.push([this.s.hod_custom_var,"Hour of Day",(new Date).getHours().toString()]):this.s.debug&&this.s.debug_mode("Hour of Day custom variable not set or in conflict, not tracking in slot "+this.s.hod_custom_var);if(this.s.include_only&&!this.match_domain(this.s.d,this.s.include_only)[0]){if(0>=this.s.alt_UA.length){this.s.debug&&
this.s.debug_mode("Tracking off: current domain does not contain an include_only domain, no alt_UA specified");this.s.track=!1;return}this.s.code=this.s.alt_UA}if(this.s.exclude_subdomains){f=this.s.d.split(".");this.s.code="";for(d=0;d<this.s.exclude_subdomains.length;d++)for(b=0;b<f.length;b++)if(f[b]==this.s.exclude_subdomains[d]){if(0>=this.s.alt_UA.length){this.s.debug&&this.s.debug_mode("Tracking off: current domain contains an excluded sub domain in this.s.exclude_subdomains and no alt_UA specified: "+
this.s.exclude_subdomains[d]);this.s.track=!1;return}this.s.code=this.s.alt_UA}""===this.s.code&&(this.s.code=this.s.UA)}this.s.enhanced_link_attribution&&(_gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),this.s.debug&&this.s.debug_mode("enhanced_link_attribution = true, inpage_linkid.js included."));for(f=0;f<this.s.code.length;f++){b=0==f?"":"t"+(f+1)+".";window._gaq.push([b+"_setAccount",this.s.code[f]]);0<this.s.domains.length?(this.current_domain_state=
this.match_domain(this.s.d),this.current_domain_state[1]?(window._gaq.push([b+"_setDomainName",this.current_domain_state[1]]),this.s.debug&&this.s.debug_mode("_setDomainName set to: "+this.current_domain_state[1]),window._gaq.push([b+"_setAllowLinker",!0]),this.s.debug&&this.s.debug_mode("_setAllowLinker set to true"),window._gaq.push([b+"_setAllowAnchor",!0]),this.s.debug&&this.s.debug_mode("_setAllowAnchor set to true"),this.s.debug&&this.s.debug_mode("Cross domain active")):(this.cross_domain_disabled=
!0,this.s.debug&&(this.s.debug_mode("Error: Cross domain defined but current domain not included, deactivating cross domain"),this.s.debug_mode("current domain: "+this.s.d),this.s.debug_mode("cross domain definition: "+this.s.domains)))):this.cross_domain_disabled=!0;for(d=0;d<this.s.custom_vars.length;d++)this.track_custom(this.s.custom_vars[d][0],this.s.custom_vars[d][1],this.s.custom_vars[d][2],this.s.custom_vars[d][3]),this.s.debug&&this.s.debug_mode("tracking custom variable: "+this.s.custom_vars[d][0]+
" "+this.s.custom_vars[d][1]+" "+this.s.custom_vars[d][2]+" "+this.s.custom_vars[d][3]);!0===this.s.auto_track_page_view?(window._gaq.push([b+"_trackPageview"]),this.s.debug&&this.s.debug_mode(this.s.code[f]+" active!")):this.s.debug&&this.s.debug_mode("page view not tracked because of auto_track_page_view but ga aware is available")}(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=c.s.demographics_tracking?("https:"==document.location.protocol?"https://":
"http://")+"stats.g.doubleclick.net/dc.js":("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();c.s.auto_social&&(this.s.enable_facebook&&(window.fbAsyncInit=function(){c.setup_social_facebook(c.s.social_page_url);g(document).ready(function(){g("body").prepend('<div id="fb-root"></div>')})},function(a,b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),
a.id=c,a.src=("https:"==document.location.protocol?"https://":"http://")+"connect.facebook.net/en_US/all.js#xfbml=1",d.parentNode.insertBefore(a,d))}(document,"script","facebook-jssdk")),this.s.enable_twitter&&(window.twttr=function(a,b,c){var d,e=a.getElementsByTagName(b)[0];if(!a.getElementById(c))return a=a.createElement(b),a.id=c,a.src=("https:"==document.location.protocol?"https://":"http://")+"platform.twitter.com/widgets.js",e.parentNode.insertBefore(a,e),window.twttr||(d={_e:[],ready:function(a){d._e.push(a)}})}(document,
"script","twitter-wjs"),window.twttr.ready(function(a){c.setup_social_twitter(c.s.social_page_url)})));this.s.bouce_defeat&&this.first_load&&setTimeout(function(){c.track_event("(Ignore Report)","Bounce Defeat",c.s.bouce_defeat.toString())},c.s.bouce_defeat);this.s.session_keeper&&setInterval(function(){c.track_event("(Ignore Report)","Keep Session Open",c.s.session_keeper.toString())},c.s.session_keeper);g(document).delegate('a:not(a[href^="javascript:"], a.'+c.s.no_track_class+")","click",c,c.link_clicks);
g(document).delegate('a:not(a[href^="javascript:"], a.'+c.s.no_track_class+")","mousedown",c,c.eval_mouseup);g(document).delegate("form:not(form."+c.s.no_track_class+")","submit",c,c.submit_forms)}},eval_mouseup:function(c){var a=c.data;if(a.s.track_right_clicks)switch(c.which){case 2:a.link_clicks(c,!0);break;case 3:a.link_clicks(c,!0)}},link_clicks:function(c,a){var e=c.data;if(e.s.track){var b=jQuery(c.currentTarget),d=b.attr("href");if(d){var f=d.split("/"),h=[];if("http:"==f[0]||"https:"==f[0]||
"//"==d.substr(0,2))h=e.match_domain(f[2]);var k=d;e.s.prefer_title&&b.attr("title")&&(k=b.attr("title"));if("http:"!=f[0]&&"https:"!=f[0]&&"//"!=d.substr(0,2)||h[4]){path=d.split("?")[0].split("#")[0];"/amm/author/lookup_page.php"==path&&(path=d.split("&url=")[1].split("&")[0].split("#")[0].split("%3F")[0]);f=path.split(".");extension=f[f.length-1];for(f=0;f<e.s.asset_extentions.length;f++)extension==e.s.asset_extentions[f]&&(a?e.link_virtual(c,b,d,k,!0,e.s.asset_prefix):e.link_virtual(c,b,d,k,!1,
e.s.asset_prefix));"#"==d[0]&&(d=document.location.pathname+document.location.search+d,b.attr("target")&&"_self"!=b.attr("target")||e.link_virtual(c,b,d,k,!0,e.s.hash_prefix));if(h=d.split(":")[0])for(f=0;f<e.s.track_alt_protocols.length;f++)h==e.s.track_alt_protocols[f]&&e.link_virtual(c,b,d,k,!0,e.s.track_alt_protocols[f])}else!h[0]||e.cross_domain_disabled?e.s.track_external_links&&(a?e.link_virtual(c,b,d,k,!0,e.s.external_prefix):e.link_virtual(c,b,d,k,!1,e.s.external_prefix)):(e.link_virtual(c,
b,d,document.location.href+" -> "+d,!1,e.remove_www(document.location.host)+" -> "+e.remove_www(d,!0),e.s.cross_domain_prefix+"Link"),h[2]==e.current_domain_state[2]&&"none"!==h[2]||a||(b.attr("target")&&"_self"!=b.attr("target")?(c.preventDefault(),window.open(window._gat._getTrackerByName()._getLinkerUrl(g(b).attr("href")),g(b).attr("target"))):(c.preventDefault(),window._gaq.push(["_link",b.attr("href")]))))}}},submit_forms:function(c){var a=c.data;if(a.s.track){var e=jQuery(c.currentTarget);try{var b=
e.attr("action");if(b){var d=b.split("/");if("http:"==d[0]||"https:"==d[0]||"//"==b.substr(0,2)){var f=a.match_domain(d[2]);if(!f[0]||f[4]||a.cross_domain_disabled)f[4]?a.s.debug&&a.s.debug_mode("Form skipped, absolute but links to same domain or cross domain is disabled: "+e):(a.s.track_as_events?a.track_event(a.s.external_form_prefix,a.s.external_prefix,b.toString()):a.track_virtual(a.s.external_prefix+"/"+a.s.external_form_prefix+"/"+b),e.attr("target")&&"_self"!=e.attr("target")||a.pause());else if(a.s.track_as_events?
a.track_event(a.s.cross_domain_prefix+a.s.external_form_prefix,a.remove_www(document.location.host)+" -> "+a.remove_www(b.toString(),!0),document.location.href+" -> "+b.toString()):a.track_virtual(a.s.external_prefix+"/"+a.s.cross_domain_prefix+"/"+document.location.href+"/"+b.toString()),a.pause(),f[2]!=a.current_domain_state[2]||"none"===f[2])"get"==e.attr("method").toLowerCase()?_gaq.push(["_linkByPost",c.target,!0]):_gaq.push(["_linkByPost",c.target])}}}catch(g){a.s.debug&&(a.s.debug_mode("error converting form: "+
g),a.s.debug_mode(e))}}},match_domain:function(c,a){if(this.s.track){a=a?a:this.s.domains;c=this.remove_www(c);for(var e=this.remove_www(this.s.d)==c?!0:!1,b=0;b<a.length;b++)if(a[b].entity){var d=this.remove_www(a[b].entity);if(d==c)return[1,d,b,!1,e];for(var f=0;f<a[b].subs.length;f++)if(a[b].subs[f]+"."+d==c)return[2,d,b,f,e]}else if(this.remove_www(a[b])==c)return[3,"none",b,!1,e];return[null,null,null,null,e]}},remove_www:function(c,a){var e;!0===a&&(e=c.split("//"),1<e.length&&(e.shift(),c=
e.join("")));e=c.split(".");"www"==e[0]&&(e.splice(0,1),c=e.join("."));return c=c.split("/")[0].split("?")[0].split("#")[0]},link_virtual:function(c,a,e,b,d,f,h){if(this.s.track){a=g(a);b=b?b:e;h=h?h:"Link";if(this.s.track_as_events)this.track_event(h,f,b);else for(c=0;c<this.s.code.length;c++)window._gaq.push([(0==c?"":"t"+(c+1)+".")+"_trackPageview",this.s.vpv_prefix+"/"+f+"/"+b]);a.attr("target")&&"_self"!=a.attr("target")?!this.s.track_as_events&&this.s.debug&&this.s.debug_mode("virtual link for new window tracked to: "+
this.s.vpv_prefix+"/"+f+"/"+b):(!this.s.track_as_events&&this.s.debug&&this.s.debug_mode("virtual link tracked to: "+this.s.vpv_prefix+"/"+f+"/"+b),d||this.pause())}},pause:function(){_gaq.push(function(){for(var c=new Date,a=c.getTime()+100;c.getTime()<a;)c=new Date})},extract_param_from_uri:function(c,a){if(c){var e=decodeURI(c.split("#")[1]);a+="=";for(var e=e.split("&"),b=0,d;d=e[b];++b)if(0===d.indexOf(a))return unescape(d.split("=")[1])}},setup_social_facebook:function(c){var a=this;if(a.s.enable_facebook)try{FB.Event.subscribe("edge.create",
function(b){a.track_social("facebook","like",b,c);a.s.debug&&a.s.debug_mode("Facebook Like captured")}),FB.Event.subscribe("edge.remove",function(b){a.track_social("facebook","unlike",b,c);a.s.debug&&a.s.debug_mode("Facebook Unlike captured")}),FB.Event.subscribe("message.send",function(b){a.track_social("facebook","send",b,c);a.s.debug&&a.s.debug_mode("Facebook Send captured")})}catch(e){a.s.debug&&a.s.debug_mode("Social Tracking enabled but Facebook has an error:"+e)}},setup_social_twitter:function(c){var a=
this;if(a.s.enable_twitter)try{twttr.events.bind("tweet",function(b){if(b){var d=document.location;b.target&&"IFRAME"==b.target.nodeName&&(d=a.extract_param_from_uri(b.target.src,"url"));a.track_social("twitter","tweet",d,c);a.s.debug&&a.s.debug_mode("Twitter event captured: "+d)}}),twttr.events.bind("click",function(b){b&&(a.track_social("twitter","click",document.location,c),a.s.debug&&a.s.debug_mode("Twitter click event"))}),twttr.events.bind("retweet",function(b){b&&(b=b.data.source_tweet_id,
a.track_social("twitter","retweet",b,c),a.s.debug&&a.s.debug_mode("Twitter retweet event for tweet id "+b))}),twttr.events.bind("favorite",function(b){b&&(b=b.data.tweet_id,a.track_social("twitter","favorite",b,c),a.s.debug&&a.s.debug_mode("Twitter favorite event for tweet id "+b))}),twttr.events.bind("follow",function(b){b&&(b=b.data.user_id+" ("+b.data.screen_name+")",a.track_social("twitter","follow",b,c),a.s.debug&&a.s.debug_mode("Twitter follow event for user "+b))})}catch(e){this.s.debug&&this.s.debug_mode("Social Tracking enabled Twitter had an error:"+
e)}},track_virtual:function(c){if(this.s.track&&c){for(var a=0;a<this.s.code.length;a++)window._gaq.push([(0==a?"":"t"+(a+1)+".")+"_trackPageview",this.s.vpv_prefix+"/"+c]);this.s.debug&&this.s.debug_mode("virtual page view tracked to: "+this.s.vpv_prefix+c)}},track_event:function(c,a,e,b){if(this.s.track){for(var d=0;d<this.s.code.length;d++)window._gaq.push([(0==d?"":"t"+(d+1)+".")+"_trackEvent",c,a,e,b]);this.s.debug&&this.s.debug_mode("event tracked as: "+c+" "+a+" "+e+" "+b)}},track_custom:function(c,
a,e,b){if(this.s.track)for(var d=0;d<this.s.code.length;d++)window._gaq.push([(0==d?"":"t"+(d+1)+".")+"_setCustomVar",c,a,e,b])},track_social:function(c,a,e,b){if(this.s.track)for(var d=0;d<this.s.code.length;d++)window._gaq.push([(0==d?"":"t"+(d+1)+".")+"_trackSocial",c,a,e,b]),!this.s.auto_social&&self.s.debug&&self.s.debug_mode("NOTE: auto_social is off but track_social method called, make sure the api is included in the html")},track_transaction:function(c,a){if(this.s.track)for(var e=0;e<this.s.code.length;e++){for(var b=
0==e?"":"t"+(e+1)+".",d=0;d<c.length;d++)this.add_item(c[d],b);_gaq.push([b+"_addTrans",a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]]);_gaq.push([b+"_trackTrans"])}},add_item:function(c,a){this.s.track&&_gaq.push([a+"_addItem",c[0],c[1],c[2],c[3],c[4],c[5]])}}})(jQuery);
